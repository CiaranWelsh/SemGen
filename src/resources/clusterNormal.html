<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>

<style>
	path.link {
	  fill: none;
	  stroke: #666;
	  stroke-width: 1.5px;
	}
		
	circle {
	  stroke: #fff;
	  stroke-width: 1.5px;
	}

	text {
	  fill: #000;
	  font-size: 10px;
	  pointer-events: none;
	}
	
	.textBackgroundColor {
		fill: white;
		opacity: .7;
	}
</style>

<script>

var width = 2000,
    height = 1000,
    padding = 50, // separation between same-color nodes
    clusterPadding = 200; // separation between different-color nodes

var data = {"nodes":[{"group":2,"name":"FPulVeins"},{"group":0,"name":"RPulVeins"},{"group":1,"name":"PPulVeins"},{"group":1,"name":"PLA"},{"group":0,"name":"EminRA"},{"group":1,"name":"VPulArtCaps"},{"group":2,"name":"VPulArtCaps:t"},{"group":0,"name":"ERA"},{"group":0,"name":"EmaxRA"},{"group":0,"name":"ActFuncAtria"},{"group":1,"name":"VLA"},{"group":0,"name":"ELA"},{"group":0,"name":"VrestLA"},{"group":0,"name":"EmaxLA"},{"group":0,"name":"VrestLAd"},{"group":0,"name":"EminLA"},{"group":2,"name":"VRA:t"},{"group":2,"name":"FTricuspidValve"},{"group":2,"name":"FSysVeins"},{"group":0,"name":"CPulVeins"},{"group":0,"name":"VrestPulVeins"},{"group":1,"name":"VPulVeins"},{"group":2,"name":"VSysVeins:t"},{"group":2,"name":"FSysArtCaps"},{"group":1,"name":"Paorta"},{"group":1,"name":"VSysArtCaps"},{"group":0,"name":"CSysArtCaps"},{"group":0,"name":"VrestSysArtCaps"},{"group":0,"name":"VrestLVs"},{"group":0,"name":"VrestLV"},{"group":0,"name":"ActFuncVentricles"},{"group":0,"name":"VrestLVd"},{"group":1,"name":"Vtotal"},{"group":1,"name":"VLV"},{"group":1,"name":"VRA"},{"group":1,"name":"VSysVeins"},{"group":1,"name":"VRV"},{"group":0,"name":"VrestLAs"},{"group":0,"name":"RMitralValve"},{"group":0,"name":"RSysVeins"},{"group":1,"name":"PRA"},{"group":1,"name":"PSysVeins"},{"group":2,"name":"FPulValve"},{"group":2,"name":"FPulArtCaps"},{"group":0,"name":"Rartcap"},{"group":0,"name":"CPulArtCaps"},{"group":0,"name":"EminLV"},{"group":1,"name":"PPulArtCaps"},{"group":0,"name":"VrestPulArtCaps"},{"group":0,"name":"VrestRA"},{"group":2,"name":"FMitralValve"},{"group":1,"name":"PLV"},{"group":0,"name":"EDVLV"},{"group":0,"name":"t.delta"},{"group":0,"name":"PRint"},{"group":2,"name":"HR"},{"group":0,"name":"t"},{"group":2,"name":"VSysArtCaps:t"},{"group":1,"name":"PRV"},{"group":0,"name":"VrestRV"},{"group":0,"name":"ERV"},{"group":2,"name":"VLA:t"},{"group":0,"name":"ELV"},{"group":0,"name":"EmaxLV"},{"group":0,"name":"RPulValve"},{"group":0,"name":"RPulArtCaps"},{"group":2,"name":"FAorticValve"},{"group":0,"name":"RTricuspidValve"},{"group":0,"name":"VrestRVs"},{"group":0,"name":"RAorticValve"},{"group":2,"name":"VRV:t"},{"group":2,"name":"VLV:t"},{"group":0,"name":"VrestRAs"},{"group":0,"name":"VrestRAd"},{"group":2,"name":"VPulVeins:t"},{"group":0,"name":"VrestSysVeins"},{"group":0,"name":"VrestRVd"},{"group":0,"name":"EmaxRV"},{"group":0,"name":"EminRV"},{"group":2,"name":"CardiacOutput"},{"group":0,"name":"CardiacOutput:t"},{"group":0,"name":"CSysVeins"},{"group":0,"name":"EDVRV"}],"links":[{"source":1,"target":0,"value":1},{"source":2,"target":0,"value":1},{"source":3,"target":0,"value":1},{"source":6,"target":5,"value":1},{"source":4,"target":7,"value":1},{"source":8,"target":7,"value":1},{"source":9,"target":7,"value":1},{"source":10,"target":3,"value":1},{"source":11,"target":3,"value":1},{"source":12,"target":3,"value":1},{"source":17,"target":16,"value":1},{"source":18,"target":16,"value":1},{"source":19,"target":2,"value":1},{"source":20,"target":2,"value":1},{"source":21,"target":2,"value":1},{"source":23,"target":22,"value":1},{"source":18,"target":22,"value":1},{"source":25,"target":24,"value":1},{"source":26,"target":24,"value":1},{"source":27,"target":24,"value":1},{"source":30,"target":29,"value":1},{"source":31,"target":29,"value":1},{"source":28,"target":29,"value":1},{"source":5,"target":32,"value":1},{"source":25,"target":32,"value":1},{"source":10,"target":32,"value":1},{"source":33,"target":32,"value":1},{"source":21,"target":32,"value":1},{"source":34,"target":32,"value":1},{"source":35,"target":32,"value":1},{"source":36,"target":32,"value":1},{"source":39,"target":18,"value":1},{"source":40,"target":18,"value":1},{"source":41,"target":18,"value":1},{"source":42,"target":6,"value":1},{"source":43,"target":6,"value":1},{"source":15,"target":11,"value":1},{"source":13,"target":11,"value":1},{"source":9,"target":11,"value":1},{"source":45,"target":47,"value":1},{"source":5,"target":47,"value":1},{"source":48,"target":47,"value":1},{"source":7,"target":40,"value":1},{"source":34,"target":40,"value":1},{"source":49,"target":40,"value":1},{"source":3,"target":50,"value":1},{"source":38,"target":50,"value":1},{"source":51,"target":50,"value":1},{"source":53,"target":52,"value":1},{"source":54,"target":52,"value":1},{"source":52,"target":52,"value":1},{"source":55,"target":52,"value":1},{"source":56,"target":52,"value":1},{"source":57,"target":25,"value":1},{"source":59,"target":58,"value":1},{"source":60,"target":58,"value":1},{"source":36,"target":58,"value":1},{"source":61,"target":10,"value":1},{"source":46,"target":62,"value":1},{"source":30,"target":62,"value":1},{"source":63,"target":62,"value":1},{"source":66,"target":57,"value":1},{"source":23,"target":57,"value":1},{"source":17,"target":70,"value":1},{"source":42,"target":70,"value":1},{"source":54,"target":30,"value":1},{"source":55,"target":30,"value":1},{"source":56,"target":30,"value":1},{"source":71,"target":33,"value":1},{"source":47,"target":42,"value":1},{"source":58,"target":42,"value":1},{"source":64,"target":42,"value":1},{"source":66,"target":71,"value":1},{"source":50,"target":71,"value":1},{"source":22,"target":35,"value":1},{"source":70,"target":36,"value":1},{"source":72,"target":49,"value":1},{"source":73,"target":49,"value":1},{"source":9,"target":49,"value":1},{"source":14,"target":12,"value":1},{"source":37,"target":12,"value":1},{"source":9,"target":12,"value":1},{"source":0,"target":74,"value":1},{"source":43,"target":74,"value":1},{"source":69,"target":66,"value":1},{"source":24,"target":66,"value":1},{"source":51,"target":66,"value":1},{"source":0,"target":61,"value":1},{"source":50,"target":61,"value":1},{"source":74,"target":21,"value":1},{"source":2,"target":43,"value":1},{"source":47,"target":43,"value":1},{"source":65,"target":43,"value":1},{"source":55,"target":9,"value":1},{"source":56,"target":9,"value":1},{"source":33,"target":51,"value":1},{"source":62,"target":51,"value":1},{"source":29,"target":51,"value":1},{"source":44,"target":23,"value":1},{"source":24,"target":23,"value":1},{"source":41,"target":23,"value":1},{"source":58,"target":17,"value":1},{"source":40,"target":17,"value":1},{"source":67,"target":17,"value":1},{"source":68,"target":59,"value":1},{"source":76,"target":59,"value":1},{"source":30,"target":59,"value":1},{"source":80,"target":79,"value":1},{"source":75,"target":41,"value":1},{"source":81,"target":41,"value":1},{"source":35,"target":41,"value":1},{"source":77,"target":60,"value":1},{"source":78,"target":60,"value":1},{"source":30,"target":60,"value":1},{"source":16,"target":34,"value":1},{"source":66,"target":80,"value":1},{"source":79,"target":80,"value":1},{"source":53,"target":82,"value":1},{"source":54,"target":82,"value":1},{"source":55,"target":82,"value":1},{"source":56,"target":82,"value":1},{"source":82,"target":82,"value":1}]}
	
// Count the numder of groups
var numGroups = 0;
for(group in data.groups) {
	numGroups++;
}
	
var color = d3.scale.category10()
    .domain(d3.range(numGroups));

// The largest node for each cluster.
var clusters = new Array(numGroups);

data.nodes.forEach(function(node) {
	node.cluster = node.group;
	node.radius = 5;
	node.x = Math.cos(node.cluster / numGroups * 2 * Math.PI) * 200 + width / 2 + Math.random();
	node.y = Math.sin(node.cluster / numGroups * 2 * Math.PI) * 200 + height / 2 + Math.random();
	
	if (!clusters[node.cluster])
		clusters[node.cluster] = node;
});

var nodes = data.nodes;
var links = data.links;

for (var i=0; i<data.links.length; ++i) {
	link = data.links[i];
	link.source = data.nodes[link.source];
	link.target = data.nodes[link.target];
}

var force = d3.layout.force()
    .nodes(nodes)
    .size([width, height])
    .gravity(.02)
    .charge(0)
    .on("tick", tick)
    .start();

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

// build the arrow.
svg.append("svg:defs").selectAll("marker")
	.data(["end"])      // Different link/path types can be defined here
  .enter().append("svg:marker")    // This section adds in the arrows
	.attr("id", String)
	.attr("viewBox", "0 -5 10 10")
	.attr("refX", 15)
	.attr("refY", -1.5)
	.attr("markerWidth", 6)
	.attr("markerHeight", 6)
	.attr("orient", "auto")
  .append("svg:path")
	.attr("d", "M0,-5L10,0L0,5");

// add the links and the arrows
var path = svg.append("svg:g").selectAll("path")
	.data(links)
  .enter().append("svg:path")
//    .attr("class", function(d) { return "link " + d.type; })
	.attr("class", "link")
	.attr("marker-end", "url(#end)");

var node = svg.selectAll("circle")
    .data(nodes)
  .enter().append("g")
  .style("fill", function(d) { return color(d.cluster); })
    .call(force.drag);
  
  node.append("circle")
	.attr("r", 5)
    

node.transition()
    .duration(750)
    .delay(function(d, i) { return i * 5; })
    .attrTween("r", function(d) {
      var i = d3.interpolate(0, d.radius);
      return function(t) { return d.radius = i(t); };
    });

// add the text 
node.append("text")
	.attr("x", 12)
	.attr("dy", ".35em")
	.text(function(d) { return d.name; });
	
// Draw rectangles behind each text element to make them stand out
node[0].forEach(function(n) {
	// Get the node's text element
	var textElement = n.getElementsByTagName("text")[0];
	
	// Get the box defining the text element
	var textBox = textElement.getBBox();
	
	// Create the rectangle
	var rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
	rect.setAttribute("x", textBox.x);
	rect.setAttribute("y", textBox.y);
	rect.setAttribute("width", textBox.width);
	rect.setAttribute("height", textBox.height);
	rect.setAttribute("class", "textBackgroundColor");

	// Add the rectangle before the text element
	n.insertBefore(rect, textElement);
});

function tick(e) {
		path.attr("d", function(d) {
				var dx = d.target.x - d.source.x,
					dy = d.target.y - d.source.y,
					dr = 0;
					//dr = Math.sqrt(dx * dx + dy * dy); // Use this value to make the links curvy
				return "M" + 
					d.source.x + "," + 
					d.source.y + "A" + 
					dr + "," + dr + " 0 0,1 " + 
					d.target.x + "," + 
					d.target.y;
			});
			
  node
      .each(cluster(10 * e.alpha * e.alpha))
      .each(collide(.5))
      .attr("cx", function(d) { return d.x; })
      .attr("cy", function(d) { return d.y; })
	  .attr("transform", function(d) { 
				return "translate(" + d.x + "," + d.y + ")"; });;
}

// Move d to be adjacent to the cluster node.
function cluster(alpha) {
  return function(d) {
    var cluster = clusters[d.cluster];
    if (cluster === d) return;
    var x = d.x - cluster.x,
        y = d.y - cluster.y,
        l = Math.sqrt(x * x + y * y),
        r = d.radius + cluster.radius;
    if (l != r) {
      l = (l - r) / l * alpha;
      d.x -= x *= l;
      d.y -= y *= l;
      cluster.x += x;
      cluster.y += y;
    }
  };
}

// Resolves collisions between d and all other circles.
function collide(alpha) {
  var quadtree = d3.geom.quadtree(nodes);
  return function(d) {
    var r = d.radius + Math.max(padding, clusterPadding),
        nx1 = d.x - r,
        nx2 = d.x + r,
        ny1 = d.y - r,
        ny2 = d.y + r;
    quadtree.visit(function(quad, x1, y1, x2, y2) {
      if (quad.point && (quad.point !== d)) {
        var x = d.x - quad.point.x,
            y = d.y - quad.point.y,
            l = Math.sqrt(x * x + y * y),
            r = d.radius + quad.point.radius + (d.cluster === quad.point.cluster ? padding : clusterPadding);
        if (l < r) {
          l = (l - r) / l * alpha;
          d.x -= x *= l;
          d.y -= y *= l;
          quad.point.x += x;
          quad.point.y += y;
        }
      }
      return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
    });
  };
}

</script>